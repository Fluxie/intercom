[
    uuid( {{lib_id}} )
]
library {{lib_name}}
{
    importlib("stdole2.tlb");

{{#each interfaces}}
    interface {{name}};
{{/each}}

{{#each interfaces}}
    [
        object,
        uuid( {{iid}} ),
        nonextensible,
        pointer_default(unique)
    ]
    interface {{name}}{{#if base}} : {{base}}{{/if}}
    {

    {{~#each methods}}
        [id({{idx}})]
        {{ret_type}} {{name}}(
        {{~#each args~}}
            [{{attributes}}] {{arg_type}} {{name}}{{#unless @last}}, {{/unless}}
        {{~/each~}}
        );
    {{/each}}
    }
{{/each}}

    // Built-in allocator interface
    [
        object,
        uuid( 18ee22b3-b0c6-44a5-a94a-7a417676fb66 ),
        nonextensible,
        pointer_default(unique)
    ]
    interface IAllocator : IUnknown
    {
        [id(0)] BSTR AllocBSTR( wchar_t* text, uint32 length );
        [id(1)] void FreeBSTR( BSTR bstr );
        [id(2)] void* Alloc( uint32 length );
        [id(3)] void Free( void* ptr );
    }

{{#each coclasses}}
    [
        uuid( {{clsid}} )
    ]
    coclass {{name}}
    {
    {{#each interfaces}}
        interface {{this}};
    {{~/each}}
    }
{{/each}}

    [
        uuid( {{allocator_clsid}} )
    ]
    coclass IntercomAllocator
    {
        interface IAllocator;
    }
}
